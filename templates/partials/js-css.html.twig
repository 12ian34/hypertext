{# Basic Refs #}
{% set structure = config.themes.hypertext.structure %}
{% set style = config.themes.hypertext.style %}
{% set stylesheets = ['air', 'latex', 'marx', 'sakura-dark-solarized', 'sakura-dark', 'sakura-earthly', 'sakura-vader',
                      'sakura', 'stylize', 'tacit', 'tufte', 'w3c-chocolate', 'w3c-midnight', 'w3c-modernist', 'w3c-oldstyle',
                      'w3c-steely', 'w3c-swiss', 'w3c-traditional', 'w3c-ultramarine', 'water-dark', 'water-light', 'writ',
                      'yorha'] %}

{# Allow CSS and JS Logic #}
{% set allowCSS = page.header.allowCSS == 'enabled' or
                    (page.header.allowCSS|default('default') == 'default' and 
                     config.themes.hypertext.structure.allowCSS == '1') %}
{% set allowJS  = page.header.allowJS  == 'enabled' or
                    (page.header.allowJS|default('default') == 'default' and 
                     config.themes.hypertext.structure.allowJS == '1') %}

{% block stylehseets %}

{# Set a stylesheet #}
{% set styleSelection = uri.param('theme') %}
{% set stylesheet = style.stylesheet %}

{# Process any stylesheet overrides from the URL bar #}
{% if styleSelection != undefined %}
    {% if styleSelection matches '/^\\d+$/' %}
        {% set stylesheet = stylesheets[uri.param('theme') + 0] %}
    {% else %}
        {% set stylesheet = stylesheets[uri.param('theme')] %}
    {% endif %}
{% endif %}

{# Add the stylesheet #}
{# TODO: Add sourcing from unpkg rather than locally #}
{% if stylesheet != 'default' and stylesheet != undefined %}
    {% if style.includeType == 'default' %}
        <style>{{ include('css/' ~ stylesheet ~ '.css') }}</style>
    {% else if not allowCSS %}
        {# No CSS but we have to do an import, so link manually #}
        <link href="{{ url('theme://css/'~stylesheet~'.css') }}" rel="stylesheet" />
    {% else %}
        {% do assets.addCss('theme://css/'~stylesheet~'.css') %}
{% endif %}

{# Regular CSS/JS includes #}
{% if allowCSS %}
    {{ assets.css()|raw }}
    {% endif %}
{% endblock %}

{% block javascripts %}
    {% if allowJS %}
    {{ assets.js()|raw }}
    {% endif %}
{% endblock %} 

{# Add custom styles after everything, so the user can adjust #}
<style>
body {
{{ layout.width ? "max-width: #{layout.width}px;" : ""}}
{{ layout.configuration ? "margin: auto;" : ""}}

{{ style.customCSS }}
</style>
