{% set stylesheets = ['air', 'latex', 'marx', 'sakura-dark-solarized', 'sakura-dark', 'sakura-earthly', 'sakura-vader',
                      'sakura', 'stylize', 'tacit', 'tufte', 'w3c-chocolate', 'w3c-midnight', 'w3c-modernist', 'w3c-oldstyle',
                      'w3c-steely', 'w3c-swiss', 'w3c-traditional', 'w3c-ultramarine', 'water-dark', 'water-light', 'writ',
                      'yorha'] %}

{# Allow CSS and JS Logic #}
{% set allowCSS = page.header.allowCSS == 'enabled' or
                    (page.header.allowCSS|default('default') == 'default' and 
                     style.allowCSS == '1') %}
{% set allowJS  = page.header.allowJS  == 'enabled' or
                    (page.header.allowJS|default('default') == 'default' and 
                     style.allowJS == '1') %}

{% block stylehseets %}

{# Set a stylesheet from URI or style config #}
{% set stylesheet = uri.query('theme')|default(style.stylesheet) %}
{# Numbers in the query need to be mapped #}
{% if stylesheet matches '/^\\d+$/' %}
    {% set stylesheet = stylesheets[stylesheet] %}
{% endif %}

{# Add the stylesheet #}
{# TODO: Add sourcing from unpkg rather than locally #}
{% if stylesheet != 'default' %}
    {% if style.includeType == 'inline' %}
        {# User *explicitly* wants it imported in style tags #}
        <style>{{ include('css/' ~ stylesheet ~ '.css') }}</style>
    {% elseif not style.allowCSS %}
        {# User wants it via href, but doesn't have CSS pipeline running #}
        <link href="{{ url('theme://css/'~stylesheet~'.css') }}" rel="stylesheet" />
    {% else %}
        {# User wants it href and is allowing CSS #}
        {% do assets.addCss('theme://css/'~stylesheet~'.css') %}
    {% endif %}
{% endif %}

{# Regular CSS/JS includes #}
{% if allowCSS %}
    {{ assets.css()|raw }}
{% endif %}
{% endblock %}

{% block javascripts %}
    {% if allowJS %}
    {{ assets.js()|raw }}
    {% endif %}
{% endblock %} 

{# Add custom styles (if avialable) after everything, so the user can adjust #}
{% if style.width != 'default' or 
      style.configuration != 'default' or
      style.customCSS != '' %}
<style>
body {
{{ style.width != 'default' ? "max-width: #{style.width}px;" : ""}}
{# Set only left and right margins because some stylesheets set vertical. #}
{# Also reset to 8px, the Chrome default (`unset` doesn't work). #}
{% if style.configuration == 'default' %}
    margin-left: 8px;
    margin-right: 8px;
{% else %}
    margin-left: auto;
    margin-right: auto;
{% endif %}

{{ style.customCSS != '' ? style.customCSS : "" }}
}
</style>
{% endif %}